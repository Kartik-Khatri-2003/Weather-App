<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="./style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>
<body>

    <div id="main">
        <div id="search">
            <input type="text" id="search_box" placeholder="Enter city name">
            <button id="search_btn"><i class='bx bx-search'></i></button>
        </div>

        <div id="error">
            <h3>invalid city name</h3>
        </div>
    
        <div id="weather">
            <!-- <img src="/images/f.png" id="weather_icon"  height="100px"> -->
            <i class='bx' id="weather_icon" alt="Weather Icon"></i>
            <h1 id="temp">Temperature (°C)</h1>
            <h1 id="city">City Name</h1>

            <div id="info">
                <div class="info_col">
                    <!-- <img src="/images/f.png" class="info_icon"  height="100px"> -->
                    <i class='bx bx-water info_icon' alt="Humidity Icon"></i>
                    <div id="humidity_info">
                        <h3 id="humidity_percentage"></h3>
                        <h3 id="humidity_label">Humidity</h3>
                    </div>
                    
                </div>
        
                <div class="info_col">
                    <!-- <img src="/images/f.png" class="info_icon"  > -->
                    <i class='bx bx-wind info_icon' alt="Wind Icon"></i>
                    <div id="wind_speed_info">
                        <h3 id="wind_speed"></h3>
                        <h3 id="wind_label">Wind Speed</h3>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>    
    
    <script>
        const searchBox = document.querySelector("#search_box");
        const searchBtn = document.querySelector("#search_btn");
        const weather = document.querySelector("#weather");
        const weatherIcon = document.querySelector("#weather_icon");
        const cityName = document.querySelector("#city");
        const temp = document.querySelector("#temp");
        const humidity = document.querySelector("#humidity_percentage");
        const windSpeed = document.querySelector("#wind_speed");  
        const error = document.querySelector( "#error");
        
        
        error.style.display = "none";  // Hide the error message initially

        const apiKey = "b4d6c5ac4e04c102e21b04b99eb70b45"; // we removed appid(key) from original apiURL and put it here
        const apiURL = "https://api.openweathermap.org/data/2.5/weather?units=metric&q=";
        // {units=metric} is used to specify the unit. {q=City Name} is used to define city name.

        /* 
           async function => is an asynchrnous function.
           it enables use of 'await' keyword inside a function tp pause execution of function until a promise is resolved or rejected.  
        */

        async function checkWeather(city){
            const response = await fetch(apiURL + city  + "&appid=" + apiKey);
            /* 
                'await' keyword can only be used inside an 'async function' 
                this keyword waits for promise to be resolved and then returns the result

                'fetch' keyword is buily-in js function used to make network requests,to get resoucres from server.
                by defualt it performs a 'GET' request
                commonly used for making API calls to retrieve data from  server.

                so the above line waits for fetch request to resolve before contine execution.
            */

            if (response.status == 404) {
                error.style.display = "block";
                weather.style.display = "none";               
            }else{
                var data = await response.json();
                //waits for response to be converted to  json format before firther execution.

                cityName.innerHTML = data.name;
                temp.innerHTML = Math.round(data.main.temp) + "°C";
                humidity.innerHTML = data.main.humidity + "%";
                windSpeed.innerHTML = Math.round(data.wind.speed) + " km/h"; 

                function setWeatherIcon(temperature){
                if(temperature >= 25){
                   weatherIcon.classList.add("bx-sun");
                }else if(temperature >= 1 && temperature < 25 ){
                   weatherIcon.src = "/images/k.jpg";
                }else {
                   weatherIcon.src = "/images/f.png";
                }
                }

                setWeatherIcon(data.main.temp);  

                error.style.display = "none";
                weather.style.display = "block"; 

            }                  
        }      

        searchBtn.addEventListener("click", () => {
            checkWeather(searchBox.value);
        });

    </script>
</body>
</html>